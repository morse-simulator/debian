From db937ea839121cd44762342c6833d4e8610a1911 Mon Sep 17 00:00:00 2001
From: Pierrick Koch <pierrick.koch@gmail.com>
Date: Mon, 15 Sep 2014 10:11:38 +0200
Subject: [PATCH] [builder] link_append dropped in 2.71.6

---
 src/morse/builder/abstractcomponent.py | 12 ++++++++----
 src/morse/builder/bpymorse.py          |  8 +++++++-
 2 files changed, 15 insertions(+), 5 deletions(-)

--- a/src/morse/builder/abstractcomponent.py
+++ b/src/morse/builder/abstractcomponent.py
@@ -633,19 +633,23 @@
                              "or default path, typically $PREFIX/share/morse/data)."% (component, looked_dirs))
                 raise FileNotFoundError("%s '%s' not found"%(self.__class__.__name__, component))
 
-        if not objects: # link_append all objects from blend file
+        if not objects: # append all objects from blend file
             objects = bpymorse.get_objects_in_blend(filepath)
 
         if prefix: # filter (used by PassiveObject)
             objects = [obj for obj in objects if obj.startswith(prefix)]
 
-        # Format the objects list for link_append
+        # Format the objects list to append
         objlist = [{'name':obj} for obj in objects]
 
         bpymorse.deselect_all()
         # Append the objects to the scene, and (auto)select them
-        bpymorse.link_append(directory=filepath + '/Object/', link=False,
-                             autoselect=True, files=objlist)
+        if bpymorse.version() >= (2, 71, 6):
+            bpymorse.append(directory=filepath + '/Object/',
+                            autoselect=True, files=objlist)
+        else:
+            bpymorse.link_append(directory=filepath + '/Object/', link=False,
+                                 autoselect=True, files=objlist)
 
         return bpymorse.get_selected_objects()
 
--- a/src/morse/builder/bpymorse.py
+++ b/src/morse/builder/bpymorse.py
@@ -32,6 +32,8 @@
 add_controller = empty_method
 add_actuator = empty_method
 link_append = empty_method
+link = empty_method # 2.71.6
+append = empty_method # 2.71.6
 collada_import = empty_method
 add_object = empty_method
 add_empty = empty_method
@@ -60,7 +62,11 @@
     add_sensor = bpy.ops.logic.sensor_add
     add_controller = bpy.ops.logic.controller_add
     add_actuator = bpy.ops.logic.actuator_add
-    link_append = bpy.ops.wm.link_append
+    if bpy.app.version >= (2, 71, 6):
+        link = bpy.ops.wm.link
+        append = bpy.ops.wm.append
+    else: # link_append dropped in 2.71.6
+        link_append = bpy.ops.wm.link_append
     collada_import = bpy.ops.wm.collada_import
     add_object = bpy.ops.object.add
     if bpy.app.version >= (2, 65, 0):
